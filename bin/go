#!/usr/bin/env bash
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

showBuildflag(){
    if [ "$?" -ne 0 ]; then
        echo -e '\x1b[30;41m'
        cat ${SCRIPT_DIR}/buildflags/failed.txt
        echo -e '\x1b[0m'
        exit 1
    else
        echo -e '\x1b[30;42m'
        cat ${SCRIPT_DIR}/buildflags/passed.txt
        echo -e '\x1b[0m'
    fi
}

frontendDir(){
    cd ${SCRIPT_DIR}/../frontend/
}

backendDir(){
    cd ${SCRIPT_DIR}/../backend/
}

tests(){
    export CI=true
    yarn test
    showBuildflag
}

tests-update(){
    export CI=true
    yarn test -- -u
    showBuildflag
}

runAllTests(){
    frontendDir
    tests
    backendDir
    tests
}

case "$@" in
    "" | "check" | "test")
        runAllTests
        ;;
    "install" | "i")
        backendDir
        yarn install
        frontendDir
        yarn install
        ;;
    "back install" | "bi")
        backendDir
        yarn install
        ;;
    "back test" | "bt")
        backendDir
        tests
        ;;
    "run")
        backendDir
        yarn start
        ;;
    "front install" | "fi")
        frontendDir
        yarn install
        ;;
    "front run" | "fr")
        frontendDir
        yarn start
        ;;
    "front test" | "ft")
        frontendDir
        tests
        ;;
    "front test update" | "ftu")
        frontendDir
        tests-update
        ;;
    "front sass" | "fs")
        frontendDir
        yarn build-css
        ;;
esac


