#!/usr/bin/env bash
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

showBuildflag(){
    if [ "$?" -ne 0 ]; then
        echo -e '\x1b[30;41m'
        cat ${SCRIPT_DIR}/buildflags/failed.txt
        echo -e '\x1b[0m'
        exit 1
    else
        echo -e '\x1b[30;42m'
        cat ${SCRIPT_DIR}/buildflags/passed.txt
        echo -e '\x1b[0m'
    fi
}

runAllTests() {
    ${SCRIPT_DIR}/../run-tests.sh
    showBuildflag
    frontendTests
    showBuildflag
}

frontendDir(){
    cd ${SCRIPT_DIR}/../frontend/
}

frontendTests(){
    frontendDir
    export CI=true
    yarn test
}

case "$@" in
    "run")
        ${SCRIPT_DIR}/../run.py -v WARN
        ;;
    "" | "check" | "test")
        runAllTests
        ;;
    "install" | "i")
        ${SCRIPT_DIR}/../setup.sh
        ;;
    "docs")
        ${SCRIPT_DIR}/../docs/build.sh
        ;;
    "front run" | "fr")
        frontendDir
        yarn start
        ;;
    "front test" | "ft")
        frontendTests
        ;;
    "front install" | "fi")
        frontendDir
        yarn install
        ;;
esac


